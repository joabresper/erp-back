name: CI (Lint, Build & Test)

# Se ejecuta cuando haces push o PR a estas ramas
on:
  push:
    branches: [ "main", "develop" ]
  pull_request:
    branches: [ "main", "develop" ]

jobs:
  validate-app:
    name: Validate and Test
    runs-on: ubuntu-latest

    steps:
    # 1. Bajamos el código del repo
    - name: Checkout code
      uses: actions/checkout@v4

    # 2. Preparamos Node.js
    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '22'
        cache: 'npm' # Esto hace que las instalaciones siguientes sean más rápidas

    # 3. Instalación limpia de dependencias
    - name: Install dependencies
      run: npm ci

    # 4. Generar Cliente de Prisma (OBLIGATORIO)
    - name: Generate Prisma Client
      run: npx prisma generate

    # 5. Linting (Calidad de código)
    - name: Run Linter
      run: npm run lint

    # 6. Build (Compilación)
    # Verifica que todo TypeScript compile correctamente a JavaScript.
    - name: Build Application
      run: npm run build

    # 7. Tests (Tus pruebas)
    # Si todo lo anterior pasó, ejecutamos Jest.
    - name: Run Tests
      run: npm run test
